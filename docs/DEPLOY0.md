# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: Azure Infrastructure –¥–ª—è Django –¥–æ–¥–∞—Ç–∫—É

## üìã –ó–∞–≥–∞–ª—å–Ω–∏–π –æ–≥–ª—è–¥

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—É—î –ø–æ–≤–Ω—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É Azure –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Django –¥–æ–¥–∞—Ç–∫—É –≤ production-—Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º best practices –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ—Å—Ç—ñ.–Ø —Å—Ç–≤–æ—Ä–∏–≤ –ø–æ–≤–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º–∏ —Å—Ö–µ–º–∞–º–∏ —Ç–∞ –¥—ñ–∞–≥—Ä–∞–º–∞–º–∏ –¥–ª—è –≤–∞—à–æ—ó Azure —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ Django –¥–æ–¥–∞—Ç–∫—É. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –≤–∫–ª—é—á–∞—î:

## üéØ **–ö–ª—é—á–æ–≤—ñ —Ä–æ–∑–¥—ñ–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó:**

### 1. **–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –¥—ñ–∞–≥—Ä–∞–º–∏**
- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ö–µ–º–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∑ Mermaid
- –î—ñ–∞–≥—Ä–∞–º–∞ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
- –°—Ö–µ–º–∞ CI/CD pipeline
- Monitoring stack –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è

### 2. **–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤**
- Resource Group —Ç–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è
- App Service –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- PostgreSQL –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- Key Vault —Ç–∞ –±–µ–∑–ø–µ–∫–∞
- Storage Account —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- Application Insights –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### 3. **–ë–µ–∑–ø–µ–∫–∞ —Ç–∞ Compliance**
- Multi-layer security –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- Zero Trust –ø—Ä–∏–Ω—Ü–∏–ø–∏
- Identity management
- Network security

### 4. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∞–ª–µ—Ä—Ç–∏**
- –ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ performance
- Business metrics
- Alert configuration
- Dashboard setup

### 5. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –≤–∏—Ç—Ä–∞—Ç**
- Cost breakdown –¥—ñ–∞–≥—Ä–∞–º–∞
- –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
- Right-sizing recommendations

### 6. **Backup —Ç–∞ DR**
- Disaster Recovery —Å—Ö–µ–º–∞
- Backup —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó
- Recovery procedures

### 7. **–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ —Å–µ–∫—Ü—ñ—ó**
- Deployment –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Django
- Troubleshooting guide
- Post-deployment checklist

## üîß **–î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Ç–∞–∫–æ–∂ –≤–∫–ª—é—á–∞—î:
- **Mermaid –¥—ñ–∞–≥—Ä–∞–º–∏** –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó
- **–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏** –∫–æ–º–∞–Ω–¥
- **Code snippets** –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- **Best practices** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- **Troubleshooting** —Å–µ–∫—Ü—ñ—ó
- **Security checklists**

–¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –º–æ–∂–µ —Å–ª—É–∂–∏—Ç–∏ —è–∫:
- **Technical specification** –¥–ª—è –∫–æ–º–∞–Ω–¥–∏
- **Onboarding guide** –¥–ª—è –Ω–æ–≤–∏—Ö —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤
- **Operations manual** –¥–ª—è DevOps
- **Architecture review** –¥–ª—è stakeholders

–ß–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ —è–∫—ñ—Å—å —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ —Ä–æ–∑–¥—ñ–ª–∏ –∞–±–æ –¥–µ—Ç–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ–≤–Ω—ñ –∞—Å–ø–µ–∫—Ç–∏?

-----------------------------------------------------------------------------

# Azure Infrastructure –¥–ª—è Django –¥–æ–¥–∞—Ç–∫—É - –ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ —Å—Ö–µ–º–∞

```mermaid
graph TB
    User[üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ] --> CDN[üåê Azure CDN]
    CDN --> AppGW[üîí Application Gateway]
    AppGW --> WebApp[üöÄ Azure App Service]
    
    WebApp --> KeyVault[üîê Azure Key Vault]
    WebApp --> DB[(üóÑÔ∏è PostgreSQL Flexible Server)]
    WebApp --> Storage[üíæ Azure Storage Account]
    WebApp --> Insights[üìä Application Insights]
    
    subgraph "Resource Group"
        WebApp
        KeyVault
        DB
        Storage
        Insights
        AppPlan[üìã App Service Plan]
    end
    
    subgraph "Security Layer"
        KeyVault
        Identity[üÜî Managed Identity]
        Firewall[üî• Database Firewall]
    end
    
    subgraph "Monitoring & Logging"
        Insights
        Logs[üìã Application Logs]
        Metrics[üìà Performance Metrics]
    end
```

## üéØ –¶—ñ–ª—ñ —Ç–∞ –≤–∏–º–æ–≥–∏

### –û—Å–Ω–æ–≤–Ω—ñ —Ü—ñ–ª—ñ:
- **–ë–µ–∑–ø–µ–∫–∞**: –ó–∞—Ö–∏—Å—Ç –¥–∞–Ω–∏—Ö —Ç–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**: –í–∏—Å–æ–∫–∏–π —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ (SLA 99.9%+)
- **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å—Ç–∞–Ω–æ–º —Å–∏—Å—Ç–µ–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è**: Infrastructure as Code –ø—ñ–¥—Ö—ñ–¥

### –¢–µ—Ö–Ω—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏:
- Python 3.11+ –¥–ª—è Django
- PostgreSQL 14+ –¥–ª—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- HTTPS-only –∑'—î–¥–Ω–∞–Ω–Ω—è
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- Backup —Ç–∞ disaster recovery

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

### 1. Resource Group (`django-app-production-rg`)
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –õ–æ–≥—ñ—á–Ω–µ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤

```bash
az group create \
    --name "django-app-production-rg" \
    --location "West Europe" \
    --tags Environment=production Project=django-app
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
- –ì—Ä—É–ø–æ–≤–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –Ω–∞ —Ä—ñ–≤–Ω—ñ –≥—Ä—É–ø–∏
- –ö–æ–Ω—Å–æ–ª—ñ–¥–æ–≤–∞–Ω–∞ –∑–≤—ñ—Ç–Ω—ñ—Å—Ç—å –ø–æ –≤–∏—Ç—Ä–∞—Ç–∞–º

### 2. Azure App Service (`django-app-production-{timestamp}`)

```mermaid
graph LR
    Client[HTTP Request] --> LB[Load Balancer]
    LB --> App1[App Instance 1]
    LB --> App2[App Instance 2]
    LB --> App3[App Instance N]
    
    App1 --> Runtime[Python 3.11 Runtime]
    App2 --> Runtime
    App3 --> Runtime
```

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è**:
- **SKU**: B1 (Basic) - –º–æ–∂–Ω–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ –¥–æ Premium
- **Runtime**: Python 3.11
- **OS**: Linux
- **HTTPS**: –ü—Ä–∏–º—É—Å–æ–≤–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ
- **Startup Command**: `gunicorn --bind=0.0.0.0 --timeout 600 config.wsgi`

**–ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞**:
```bash
DJANGO_SETTINGS_MODULE="config.settings.production"
SECRET_KEY="@Microsoft.KeyVault(...)"
DATABASE_URL="postgresql://..."
AZURE_STORAGE_ACCOUNT_NAME="djapp..."
DEBUG="False"
ALLOWED_HOSTS="*.azurewebsites.net"
```

### 3. PostgreSQL Flexible Server

```mermaid
graph TB
    App[Django App] --> Conn[Connection Pool]
    Conn --> Primary[(Primary DB)]
    Primary --> Backup[(Automated Backup)]
    Primary --> Replica[(Read Replica)]
    
    subgraph "Security"
        Firewall[Database Firewall]
        SSL[SSL/TLS Encryption]
        VNet[Virtual Network]
    end
```

**–°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è**:
- **–í–µ—Ä—Å—ñ—è**: PostgreSQL 14
- **SKU**: Standard_D2ds_v4 (2 vCores, 8GB RAM)
- **Storage**: 32GB (auto-scaling enabled)
- **Backup**: 7 –¥–Ω—ñ–≤ retention
- **SSL**: –û–±–æ–≤'—è–∑–∫–æ–≤–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è

**Firewall Rules**:
```bash
# Azure Services access
Start IP: 0.0.0.0
End IP: 0.0.0.0

# Specific IP ranges (production)
Start IP: YOUR_OFFICE_IP
End IP: YOUR_OFFICE_IP
```

### 4. Azure Key Vault (`djapp-kv-{shortcode}`)

```mermaid
graph LR
    App[Django App] --> MSI[Managed Identity]
    MSI --> KV[Key Vault]
    
    subgraph "Stored Secrets"
        Secret1[Django Secret Key]
        Secret2[DB Password]
        Secret3[Storage Key]
        Secret4[API Keys]
    end
    
    KV --> Secret1
    KV --> Secret2
    KV --> Secret3
    KV --> Secret4
```

**–ë–µ–∑–ø–µ–∫–∞**:
- **Access Policy**: Managed Identity –∑ –ø—Ä–∞–≤–∞–º–∏ get/list
- **Soft Delete**: –£–≤—ñ–º–∫–Ω–µ–Ω–æ (90 –¥–Ω—ñ–≤)
- **Network Access**: Public –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏
- **Audit Logging**: –í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è

**–°–µ–∫—Ä–µ—Ç–∏**:
```bash
django-secret-key      # 50-—Å–∏–º–≤–æ–ª—å–Ω–∏–π –∫–ª—é—á
database-password      # –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å –ë–î
storage-account-key    # –ö–ª—é—á –¥–æ—Å—Ç—É–ø—É –¥–æ Storage
app-insights-key       # Instrumentation key
```

### 5. Azure Storage Account

```mermaid
graph TB
    Django[Django App] --> Static[Static Files Container]
    Django --> Media[Media Files Container]
    
    subgraph "Storage Account"
        Static --> Blob1[CSS/JS/Images]
        Media --> Blob2[User Uploads]
    end
    
    CDN[Azure CDN] --> Static
    CDN --> Media
```

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è**:
- **Type**: StorageV2 (General Purpose v2)
- **Performance**: Standard
- **Replication**: LRS (Locally Redundant)
- **Access Tier**: Hot
- **Public Access**: Blob level

**Containers**:
```bash
static/     # Django static files (CSS, JS, images)
media/      # User uploaded content
backups/    # Database backups (optional)
```

### 6. Application Insights

```mermaid
graph LR
    App[Django App] --> SDK[AI SDK]
    SDK --> AI[Application Insights]
    
    subgraph "Telemetry"
        Requests[HTTP Requests]
        Exceptions[Exceptions]
        Dependencies[Dependencies]
        Performance[Performance]
    end
    
    AI --> Requests
    AI --> Exceptions
    AI --> Dependencies
    AI --> Performance
    
    AI --> Alerts[Smart Alerts]
    AI --> Dashboard[Monitoring Dashboard]
```

**–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**:
- **Request Tracking**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ HTTP –∑–∞–ø–∏—Ç—ñ–≤
- **Exception Tracking**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫
- **Performance Counters**: CPU, Memory, Disk I/O
- **Custom Metrics**: –ë—ñ–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ Django
- **Dependency Tracking**: Database, External APIs

## üîÑ –ü—Ä–æ—Ü–µ—Å —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –°—Ö–µ–º–∞ CI/CD Pipeline

```mermaid
graph TB
    Dev[üë®‚Äçüíª Developer] --> Git[üìù Git Push]
    Git --> GHA[üîÑ GitHub Actions]
    
    GHA --> Test[üß™ Run Tests]
    Test --> Build[üèóÔ∏è Build App]
    Build --> Deploy[üöÄ Deploy to Azure]
    
    Deploy --> WebApp[App Service]
    Deploy --> DB[Run Migrations]
    Deploy --> Static[Upload Static Files]
    
    WebApp --> Health[Health Check]
    Health --> Monitor[Start Monitoring]
```

### –ö—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º:

1. **–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–¥—É**:
   ```bash
   # requirements.txt
   Django>=4.2,<5.0
   psycopg2-binary>=2.9.0
   gunicorn>=20.1.0
   django-storages[azure]>=1.13.0
   ```

2. **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Django**:
   ```python
   # settings/production.py
   import os
   from .base import *
   
   DEBUG = False
   ALLOWED_HOSTS = [os.environ.get('ALLOWED_HOSTS')]
   
   # Database
   DATABASES = {
       'default': dj_database_url.parse(os.environ.get('DATABASE_URL'))
   }
   
   # Azure Storage
   DEFAULT_FILE_STORAGE = 'storages.backends.azure_storage.AzureStorage'
   STATICFILES_STORAGE = 'storages.backends.azure_storage.AzureStorage'
   ```

3. **Deployment**:
   ```bash
   # ZIP deployment
   az webapp deployment source config-zip \
       --src app.zip \
       --name $WEB_APP_NAME \
       --resource-group $RESOURCE_GROUP
   ```

## üîí –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ Compliance

### Security Layers

```mermaid
graph TB
    Internet[üåê Internet] --> WAF[üõ°Ô∏è Web Application Firewall]
    WAF --> TLS[üîê TLS 1.2+ Encryption]
    TLS --> App[üöÄ App Service]
    
    App --> MSI[üÜî Managed Identity]
    MSI --> KV[üîê Key Vault]
    
    App --> DB[(üóÑÔ∏è Database)]
    DB --> Encryption[üîí Encryption at Rest]
    
    subgraph "Network Security"
        VNet[Virtual Network]
        NSG[Network Security Groups]
        Firewall[Database Firewall]
    end
    
    subgraph "Identity & Access"
        RBAC[Role-Based Access Control]
        AAD[Azure Active Directory]
        MSI
    end
```

### –ü—Ä–∏–Ω—Ü–∏–ø–∏ –±–µ–∑–ø–µ–∫–∏:

1. **Zero Trust Architecture**:
   - –ù–µ–º–∞—î –¥–æ–≤—ñ—Ä–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É
   - –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É

2. **Encryption Everywhere**:
   - HTTPS –¥–ª—è –≤—Å—å–æ–≥–æ —Ç—Ä–∞—Ñ—ñ–∫—É
   - TLS 1.2+ –¥–ª—è –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
   - Encryption at rest –¥–ª—è Storage

3. **Identity Management**:
   - Managed Identity –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
   - RBAC –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É
   - Azure AD —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

4. **Network Security**:
   - Database firewall rules
   - Private endpoints (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
   - DDoS protection

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∞–ª–µ—Ä—Ç–∏

### Monitoring Stack

```mermaid
graph TB
    App[Django Application] --> Metrics[üìà Custom Metrics]
    App --> Logs[üìã Application Logs]
    App --> Traces[üîç Distributed Tracing]
    
    Metrics --> AI[Application Insights]
    Logs --> AI
    Traces --> AI
    
    AI --> Alerts[üö® Smart Alerts]
    AI --> Dashboard[üìä Dashboard]
    AI --> Reports[üìë Reports]
    
    subgraph "Alert Types"
        Performance[Performance Degradation]
        Errors[Error Rate Increase]
        Availability[Availability Issues]
        Security[Security Events]
    end
    
    Alerts --> Performance
    Alerts --> Errors
    Alerts --> Availability
    Alerts --> Security
```

### –ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏:

1. **Performance Metrics**:
   - Response time (< 500ms target)
   - Throughput (requests/second)
   - Error rate (< 1% target)
   - Database query performance

2. **Infrastructure Metrics**:
   - CPU utilization (< 80%)
   - Memory usage (< 85%)
   - Disk I/O
   - Network latency

3. **Business Metrics**:
   - User registrations
   - Page views
   - Feature usage
   - Conversion rates

## üí∞ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –≤–∏—Ç—Ä–∞—Ç

### Cost Breakdown

```mermaid
pie title –©–æ–º—ñ—Å—è—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ (USD)
    "App Service B1" : 55
    "PostgreSQL D2ds_v4" : 120
    "Storage Account" : 10
    "Application Insights" : 20
    "Key Vault" : 5
    "Bandwidth" : 15
```

### –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:

1. **Right-sizing Resources**:
   - –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
   - Reserved Instances –¥–ª—è –¥–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤

2. **Storage Optimization**:
   - Lifecycle policies –¥–ª—è —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤
   - Cool/Archive tiers –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö –∫–æ–ø—ñ–π
   - CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤

3. **Database Optimization**:
   - Connection pooling
   - Query optimization
   - Read replicas –¥–ª—è read-heavy workloads

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É Django

```
django-project/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ development.py
‚îÇ   ‚îú‚îÄ‚îÄ wsgi.py
‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îî‚îÄ‚îÄ your_app/
‚îú‚îÄ‚îÄ static/
‚îú‚îÄ‚îÄ media/
‚îú‚îÄ‚îÄ requirements/
‚îÇ   ‚îú‚îÄ‚îÄ base.txt
‚îÇ   ‚îî‚îÄ‚îÄ production.txt
‚îú‚îÄ‚îÄ startup.sh
‚îú‚îÄ‚îÄ web.config
‚îî‚îÄ‚îÄ infrastructure-summary.txt
```

### –ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:

1. **Django Settings**:
   ```python
   # config/settings/production.py
   from .base import *
   import dj_database_url
   
   DEBUG = False
   ALLOWED_HOSTS = [os.environ.get('ALLOWED_HOSTS')]
   
   # Database
   DATABASES = {
       'default': dj_database_url.parse(
           os.environ.get('DATABASE_URL'),
           conn_max_age=600
       )
   }
   
   # Azure Storage
   DEFAULT_FILE_STORAGE = 'storages.backends.azure_storage.AzureStorage'
   AZURE_ACCOUNT_NAME = os.environ.get('AZURE_STORAGE_ACCOUNT_NAME')
   AZURE_ACCOUNT_KEY = os.environ.get('AZURE_STORAGE_ACCOUNT_KEY')
   ```

2. **Startup Configuration**:
   ```bash
   #!/bin/bash
   echo "Starting Django application..."
   
   # Install dependencies
   pip install -r requirements.txt
   
   # Collect static files
   python manage.py collectstatic --noinput
   
   # Run migrations
   python manage.py migrate --noinput
   
   # Start Gunicorn
   exec gunicorn --bind=0.0.0.0:8000 --timeout 600 --workers 3 config.wsgi
   ```

## üöÄ –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è

### –ö–æ–º–∞–Ω–¥–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:

1. **–ü–æ–≤–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è**:
   ```bash
   ./script_azure.sh
   ```

2. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É**:
   ```bash
   az webapp deployment source config-zip \
       --src app.zip \
       --name django-app-production-{timestamp} \
       --resource-group django-app-production-rg
   ```

3. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥—ñ–≤**:
   ```bash
   az webapp log tail \
       --name django-app-production-{timestamp} \
       --resource-group django-app-production-rg
   ```

4. **–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è**:
   ```bash
   az appservice plan update \
       --name django-app-production-plan \
       --resource-group django-app-production-rg \
       --sku P1V2
   ```

## üîÑ Backup —Ç–∞ Disaster Recovery

### Backup Strategy

```mermaid
graph TB
    App[Production App] --> DB[(Primary DB)]
    DB --> AutoBackup[Automated Backup]
    DB --> Replica[(Read Replica)]
    
    Storage[Storage Account] --> GeoReplication[Geo-Replication]
    
    AutoBackup --> Retention[7-day Retention]
    AutoBackup --> PITR[Point-in-Time Recovery]
    
    subgraph "Disaster Recovery"
        SecondaryRegion[Secondary Region]
        DR_App[DR App Service]
        DR_DB[(DR Database)]
    end
    
    Replica --> DR_DB
    GeoReplication --> SecondaryRegion
```

### Recovery Procedures:

1. **Database Recovery**:
   ```bash
   # Point-in-time restore
   az postgres flexible-server restore \
       --source-server django-app-production-db-{timestamp} \
       --target-server django-app-restored-{date} \
       --restore-time "2023-10-01T12:00:00Z"
   ```

2. **Application Recovery**:
   ```bash
   # Deploy from backup
   az webapp deployment source config-zip \
       --src backup-{date}.zip \
       --name django-app-dr-{timestamp}
   ```

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### Immediate Tasks:
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –¥–æ–¥–∞—Ç–∫—É
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î
- [ ] –í–µ—Ä–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ HTTPS
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ –Ω–∞ –ø–æ–º–∏–ª–∫–∏
- [ ] –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ä–æ–±–æ—Ç—É Application Insights

### Security Review:
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ firewall rules
- [ ] –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ SSL/TLS –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É Key Vault
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ Managed Identity

### Performance Testing:
- [ ] Load testing
- [ ] Database performance
- [ ] Static files delivery
- [ ] Response time monitoring

### Monitoring Setup:
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–ª–µ—Ä—Ç–∏
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ dashboard
- [ ] –ö–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞—Ç–∏ notifications
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏

## üîó –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

- [Azure App Service Documentation](https://docs.microsoft.com/en-us/azure/app-service/)
- [PostgreSQL on Azure](https://docs.microsoft.com/en-us/azure/postgresql/)
- [Azure Key Vault Best Practices](https://docs.microsoft.com/en-us/azure/key-vault/general/best-practices)
- [Django Deployment Guide](https://docs.djangoproject.com/en/4.2/howto/deployment/)
- [Application Insights for Python](https://docs.microsoft.com/en-us/azure/azure-monitor/app/opencensus-python)

---

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏:
- **Technical Lead**: [your-email@company.com]
- **DevOps Team**: [devops@company.com]
- **Emergency**: [emergency-contact]


------------------------------------------------------

```bash
# =============================================================================
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤–Ω–æ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ Azure –¥–ª—è Django –¥–æ–¥–∞—Ç–∫—É
# =============================================================================

set -e  # –ó—É–ø–∏–Ω–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ

# –ö–æ–ª—å–æ—Ä–∏ –¥–ª—è –≤–∏–≤–æ–¥—É
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
    exit 1
}

warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

# =============================================================================
# –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø - –ù–ê–õ–ê–®–¢–£–ô–¢–ï –¶–Ü –ó–ú–Ü–ù–ù–Ü
# =============================================================================

# –û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
PROJECT_NAME="django-app"
ENVIRONMENT="production"  # production, staging, development
LOCATION="West Europe"
TIMESTAMP=$(date +%s)

# –Ü–º–µ–Ω–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤
RESOURCE_GROUP_NAME="${PROJECT_NAME}-${ENVIRONMENT}-rg"
APP_SERVICE_PLAN_NAME="${PROJECT_NAME}-${ENVIRONMENT}-plan"
WEB_APP_NAME="${PROJECT_NAME}-${ENVIRONMENT}-${TIMESTAMP}"
DATABASE_SERVER_NAME="${PROJECT_NAME}-${ENVIRONMENT}-db-${TIMESTAMP}"
DATABASE_NAME="${PROJECT_NAME}_db"
#STORAGE_ACCOUNT_NAME="${PROJECT_NAME}${ENVIRONMENT}storage${TIMESTAMP}"
STORAGE_ACCOUNT_NAME="djapp$(date +%s | tail -c 8)"
#KEY_VAULT_NAME="${PROJECT_NAME}-${ENVIRONMENT}-kv-${TIMESTAMP}"
KEY_VAULT_NAME="djapp-kv-$(date +%s | tail -c 6)"  # –ö–æ—Ä–æ—Ç—à–∞ –Ω–∞–∑–≤–∞ (16 —Å–∏–º–≤–æ–ª—ñ–≤)
APP_INSIGHTS_NAME="${PROJECT_NAME}-${ENVIRONMENT}-insights"

# –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è App Service
APP_SERVICE_SKU="B1"  # F1 (Free), B1 (Basic), S1 (Standard), P1V2 (Premium)
PYTHON_VERSION="3.11"

# –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
DB_ADMIN_USER="djangoadmin"
DB_ADMIN_PASSWORD="$(openssl rand -base64 32 | tr -d '=/+' | cut -c1-16)Aa1!"
#DB_SKU="GP_Gen5_1"  # General Purpose, 1 vCore
DB_SKU="Standard_D2ds_v4"

# –¢–µ–≥–∏ –¥–ª—è —Ä–µ—Å—É—Ä—Å—ñ–≤
TAGS="Environment=${ENVIRONMENT} Project=${PROJECT_NAME} CreatedBy=AzureCLI"

log "–ü–æ—á–∞—Ç–æ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–ª—è Django –¥–æ–¥–∞—Ç–∫—É..."
log "–ü—Ä–æ–µ–∫—Ç: ${PROJECT_NAME}"
log "–°–µ—Ä–µ–¥–æ–≤–∏—â–µ: ${ENVIRONMENT}"
log "–†–µ–≥—ñ–æ–Ω: ${LOCATION}"

# =============================================================================
# –ü–ï–†–ï–í–Ü–†–ö–ê –ó–ê–õ–ï–ñ–ù–û–°–¢–ï–ô
# =============================================================================

log "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Azure CLI
if ! command -v az &> /dev/null; then
    error "Azure CLI –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –π–æ–≥–æ –∑ https://docs.microsoft.com/en-us/cli/azure/install-azure-cli"
fi

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
if ! az account show &> /dev/null; then
    error "–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –≤ Azure CLI. –í–∏–∫–æ–Ω–∞–π—Ç–µ 'az login'"
fi

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ openssl –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∞—Ä–æ–ª—ñ–≤
if ! command -v openssl &> /dev/null; then
    error "OpenSSL –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
fi

log "‚úÖ –í—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ"

# =============================================================================
# –°–¢–í–û–†–ï–ù–ù–Ø –†–ï–°–£–†–°–Ü–í
# =============================================================================

# 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Resource Group
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Resource Group: ${RESOURCE_GROUP_NAME}"
az group create \
    --name "$RESOURCE_GROUP_NAME" \
    --location "$LOCATION" \
    --tags $TAGS

# 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Storage Account –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –º–µ–¥—ñ–∞
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Storage Account: ${STORAGE_ACCOUNT_NAME}"
az storage account create \
    --name "$STORAGE_ACCOUNT_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --location "$LOCATION" \
    --sku Standard_LRS \
    --kind StorageV2 \
    --access-tier Hot \
    --tags $TAGS

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –º–µ–¥—ñ–∞
STORAGE_KEY=$(az storage account keys list \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --account-name "$STORAGE_ACCOUNT_NAME" \
    --query '[0].value' \
    --output tsv)

az storage container create \
    --name "static" \
    --account-name "$STORAGE_ACCOUNT_NAME" \
    --account-key "$STORAGE_KEY" \
    --public-access blob

az storage container create \
    --name "media" \
    --account-name "$STORAGE_ACCOUNT_NAME" \
    --account-key "$STORAGE_KEY" \
    --public-access blob

# 3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è PostgreSQL Database
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è PostgreSQL —Å–µ—Ä–≤–µ—Ä–∞: ${DATABASE_SERVER_NAME}"
az postgres flexible-server create \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --name "$DATABASE_SERVER_NAME" \
    --location "$LOCATION" \
    --admin-user "$DB_ADMIN_USER" \
    --admin-password "$DB_ADMIN_PASSWORD" \
    --sku-name "$DB_SKU" \
    --storage-size 32 \
    --version 14 \
    --public-access 0.0.0.0 \
    --tags $TAGS

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: ${DATABASE_NAME}"
az postgres flexible-server db create \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --server-name "$DATABASE_SERVER_NAME" \
    --database-name "$DATABASE_NAME"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è firewall –ø—Ä–∞–≤–∏–ª
log "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è firewall –ø—Ä–∞–≤–∏–ª –¥–ª—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö"
az postgres flexible-server firewall-rule create \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --name "$DATABASE_SERVER_NAME" \
    --rule-name "AllowAzureServices" \
    --start-ip-address 0.0.0.0 \
    --end-ip-address 0.0.0.0

# 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Key Vault –¥–ª—è —Å–µ–∫—Ä–µ—Ç—ñ–≤
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Key Vault: ${KEY_VAULT_NAME}"
az keyvault create \
    --name "$KEY_VAULT_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --location "$LOCATION" \
    --enable-rbac-authorization false \
    --tags $TAGS

# –û—Ç—Ä–∏–º–∞–π—Ç–µ –≤–∞—à User Principal ID
USER_ID=$(az ad signed-in-user show --query id --output tsv)
echo "Your User ID: $USER_ID"

# –û—Ç—Ä–∏–º–∞–π—Ç–µ –ø–æ—Ç–æ—á–Ω—É –ø—ñ–¥–ø–∏—Å–∫—É ID
SUBSCRIPTION_ID=$(az account show --query id --output tsv)
echo "Subscription ID: $SUBSCRIPTION_ID"

# –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π scope –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ Key Vault
KEY_VAULT_SCOPE="/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP_NAME}/providers/Microsoft.KeyVault/vaults/${KEY_VAULT_NAME}"

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Access Policy –∑–∞–º—ñ—Å—Ç—å RBAC (—à–≤–∏–¥—à–µ —ñ –Ω–∞–¥—ñ–π–Ω—ñ—à–µ)
log "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ Key Vault"

az keyvault set-policy \
    --name "$KEY_VAULT_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --object-id "$(az ad signed-in-user show --query id --output tsv)" \
    --secret-permissions get list set delete


# –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç—ñ–≤
log "–î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –¥–æ Key Vault"
DJANGO_SECRET_KEY=$(openssl rand -base64 50 | tr -d '=/+')

# –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –ø–æ–º–∏–ª–æ–∫
if az keyvault secret set \
    --vault-name "$KEY_VAULT_NAME" \
    --name "django-secret-key" \
    --value "$DJANGO_SECRET_KEY" >/dev/null 2>&1; then
    log "‚úÖ Django secret key –¥–æ–¥–∞–Ω–æ"
else
    log "‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è Django secret key"
fi

if az keyvault secret set \
    --vault-name "$KEY_VAULT_NAME" \
    --name "database-password" \
    --value "$DB_ADMIN_PASSWORD" >/dev/null 2>&1; then
    log "‚úÖ Database password –¥–æ–¥–∞–Ω–æ"
else
    log "‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è database password"
fi

if az keyvault secret set \
    --vault-name "$KEY_VAULT_NAME" \
    --name "storage-account-key" \
    --value "$STORAGE_KEY" >/dev/null 2>&1; then
    log "‚úÖ Storage account key –¥–æ–¥–∞–Ω–æ"
else
    log "‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è storage account key"
fi

#-------------
#log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Key Vault: ${KEY_VAULT_NAME}"
#az keyvault create \
#    --name "$KEY_VAULT_NAME" \
#    --resource-group "$RESOURCE_GROUP_NAME" \
#    --location "$LOCATION" \
#    --tags $TAGS


# –û—Ç—Ä–∏–º–∞–π—Ç–µ –≤–∞—à User Principal ID
#USER_ID=$(az ad signed-in-user show --query id --output tsv)
#echo "Your User ID: $USER_ID"

# –ù–∞–¥–∞–π—Ç–µ —Å–æ–±—ñ —Ä–æ–ª—å Key Vault Secrets Officer
#az role assignment create \
#    --assignee "$USER_ID" \
#    --role "Key Vault Secrets Officer" \
#    --scope "/subscriptions/f7dc8823-4f06-4346-9de0-badbe6273a54/resourceGroups/django-app-production-rg/providers/Microsoft.KeyVault/vaults/djapp-kv-89430"

# –ó–∞—á–µ–∫–∞–π—Ç–µ 2-3 —Ö–≤–∏–ª–∏–Ω–∏ –¥–ª—è –ø–æ—à–∏—Ä–µ–Ω–Ω—è –ø—Ä–∞–≤, –ø–æ—Ç—ñ–º –¥–æ–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–∏
#sleep 180


# –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –¥–æ Key Vault
#log "–î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –¥–æ Key Vault"
#DJANGO_SECRET_KEY=$(openssl rand -base64 50 | tr -d '=/+')

#az keyvault secret set \
#    --vault-name "$KEY_VAULT_NAME" \
#    --name "django-secret-key" \
#    --value "$DJANGO_SECRET_KEY"

#az keyvault secret set \
#    --vault-name "$KEY_VAULT_NAME" \
#    --name "database-password" \
#    --value "$DB_ADMIN_PASSWORD"

#az keyvault secret set \
#    --vault-name "$KEY_VAULT_NAME" \
#    --name "storage-account-key" \
#    --value "$STORAGE_KEY"

# 5. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Application Insights
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Application Insights: ${APP_INSIGHTS_NAME}"
az monitor app-insights component create \
    --app "$APP_INSIGHTS_NAME" \
    --location "$LOCATION" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --tags $TAGS

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è Instrumentation Key
INSTRUMENTATION_KEY=$(az monitor app-insights component show \
    --app "$APP_INSIGHTS_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --query "instrumentationKey" \
    --output tsv)

# 6. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è App Service Plan
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è App Service Plan: ${APP_SERVICE_PLAN_NAME}"
az appservice plan create \
    --name "$APP_SERVICE_PLAN_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --location "$LOCATION" \
    --sku "$APP_SERVICE_SKU" \
    --is-linux \
    --tags $TAGS

# 7. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Web App
log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Web App: ${WEB_APP_NAME}"
az webapp create \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --plan "$APP_SERVICE_PLAN_NAME" \
    --runtime "PYTHON:${PYTHON_VERSION}" \
    --tags $TAGS

# 8. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è Django
log "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞"
DATABASE_URL="postgresql://${DB_ADMIN_USER}:${DB_ADMIN_PASSWORD}@${DATABASE_SERVER_NAME}.postgres.database.azure.com:5432/${DATABASE_NAME}?sslmode=require"

az webapp config appsettings set \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --settings \
        DJANGO_SETTINGS_MODULE="config.settings.production" \
        SECRET_KEY="@Microsoft.KeyVault(VaultName=${KEY_VAULT_NAME};SecretName=django-secret-key)" \
        DATABASE_URL="$DATABASE_URL" \
        AZURE_STORAGE_ACCOUNT_NAME="$STORAGE_ACCOUNT_NAME" \
        AZURE_STORAGE_ACCOUNT_KEY="@Microsoft.KeyVault(VaultName=${KEY_VAULT_NAME};SecretName=storage-account-key)" \
        AZURE_STORAGE_CONTAINER_STATIC="static" \
        AZURE_STORAGE_CONTAINER_MEDIA="media" \
        APPINSIGHTS_INSTRUMENTATIONKEY="$INSTRUMENTATION_KEY" \
        APPLICATIONINSIGHTS_CONNECTION_STRING="InstrumentationKey=${INSTRUMENTATION_KEY}" \
        DEBUG="False" \
        ALLOWED_HOSTS="${WEB_APP_NAME}.azurewebsites.net" \
        DJANGO_LOG_LEVEL="INFO" \
        PYTHONPATH="/home/site/wwwroot"

# 9. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è App Service –¥–ª—è Django
log "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è App Service –¥–ª—è Django"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è startup –∫–æ–º–∞–Ω–¥–∏
az webapp config set \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --startup-file "gunicorn --bind=0.0.0.0 --timeout 600 config.wsgi"

# –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–≤
az webapp log config \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --application-logging filesystem \
    --detailed-error-messages true \
    --failed-request-tracing true \
    --web-server-logging filesystem

# 10. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è managed identity –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Key Vault
log "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Managed Identity"
az webapp identity assign \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME"

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è Principal ID
PRINCIPAL_ID=$(az webapp identity show \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --query "principalId" \
    --output tsv)

# –ù–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ Key Vault
az keyvault set-policy \
    --name "$KEY_VAULT_NAME" \
    --object-id "$PRINCIPAL_ID" \
    --secret-permissions get list

# 11. –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è HTTPS
log "–£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è HTTPS"
az webapp update \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --https-only true

# 12. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è custom domain (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
# –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ —è–∫—â–æ –º–∞—î—Ç–µ –∫–∞—Å—Ç–æ–º–Ω–∏–π –¥–æ–º–µ–Ω
# CUSTOM_DOMAIN="yourdomain.com"
# az webapp config hostname add \
#     --webapp-name "$WEB_APP_NAME" \
#     --resource-group "$RESOURCE_GROUP_NAME" \
#     --hostname "$CUSTOM_DOMAIN"

# =============================================================================
# –°–¢–í–û–†–ï–ù–ù–Ø –§–ê–ô–õ–Ü–í –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–á
# =============================================================================

log "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó"

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è requirements.txt
cat > requirements.txt << 'EOF'
Django>=4.2,<5.0
psycopg2-binary>=2.9.0
gunicorn>=20.1.0
django-storages[azure]>=1.13.0
python-decouple>=3.6
applicationinsights>=0.11.10
opencensus-ext-azure>=1.1.0
opencensus-ext-django>=0.8.0
whitenoise>=6.0.0
Pillow>=9.0.0
celery>=5.2.0
redis>=4.0.0
EOF

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è .env.example
cat > .env.example << EOF
# Django Settings
SECRET_KEY=your-secret-key-here
DEBUG=False
ALLOWED_HOSTS=${WEB_APP_NAME}.azurewebsites.net

# Database
DATABASE_URL=postgresql://user:password@host:port/database

# Azure Storage
AZURE_STORAGE_ACCOUNT_NAME=${STORAGE_ACCOUNT_NAME}
AZURE_STORAGE_ACCOUNT_KEY=your-storage-key
AZURE_STORAGE_CONTAINER_STATIC=static
AZURE_STORAGE_CONTAINER_MEDIA=media

# Application Insights
APPINSIGHTS_INSTRUMENTATIONKEY=${INSTRUMENTATION_KEY}
EOF

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è startup.sh –¥–ª—è App Service
cat > startup.sh << 'EOF'
#!/bin/bash

echo "Starting Django application..."

# Collect static files
python manage.py collectstatic --noinput

# Run migrations
python manage.py migrate --noinput

# Start Gunicorn
exec gunicorn --bind=0.0.0.0:8000 --timeout 600 --workers 3 config.wsgi:application
EOF

chmod +x startup.sh

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è web.config –¥–ª—è App Service
cat > web.config << 'EOF'
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <add name="PythonHandler" path="*" verb="*" modules="httpPlatformHandler" resourceType="Unspecified"/>
    </handlers>
    <httpPlatform processPath="python" arguments="manage.py runserver --noreload 0.0.0.0:%HTTP_PLATFORM_PORT%" stdoutLogEnabled="true" stdoutLogFile="python.log" startupTimeLimit="60" processesPerApplication="16">
      <environmentVariables>
        <environmentVariable name="PYTHONPATH" value="%PYTHONPATH%;%{APPL_PHYSICAL_PATH}"/>
      </environmentVariables>
    </httpPlatform>
  </system.webServer>
</configuration>
EOF

# =============================================================================
# –ü–Ü–î–°–£–ú–û–ö
# =============================================================================

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è URL –¥–æ–¥–∞—Ç–∫—É
APP_URL=$(az webapp show \
    --name "$WEB_APP_NAME" \
    --resource-group "$RESOURCE_GROUP_NAME" \
    --query "defaultHostName" \
    --output tsv)

log "‚úÖ –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞!"

echo ""
echo "=========================================="
echo "üìã –ü–Ü–î–°–£–ú–û–ö –°–¢–í–û–†–ï–ù–ò–• –†–ï–°–£–†–°–Ü–í"
echo "=========================================="
echo "üåç Resource Group: $RESOURCE_GROUP_NAME"
echo "üöÄ Web App: $WEB_APP_NAME"
echo "üîó URL: https://$APP_URL"
echo "üìä App Service Plan: $APP_SERVICE_PLAN_NAME ($APP_SERVICE_SKU)"
echo "üóÑÔ∏è  PostgreSQL Server: $DATABASE_SERVER_NAME"
echo "üóÉÔ∏è  Database: $DATABASE_NAME"
echo "üíæ Storage Account: $STORAGE_ACCOUNT_NAME"
echo "üîê Key Vault: $KEY_VAULT_NAME"
echo "üìà Application Insights: $APP_INSIGHTS_NAME"
echo ""
echo "=========================================="
echo "üîë –î–û–°–¢–£–ü–ò (–ó–ë–ï–†–ï–ñ–Ü–¢–¨ –í –ë–ï–ó–ü–ï–ß–ù–û–ú–£ –ú–Ü–°–¶–Ü!)"
echo "=========================================="
echo "Database Admin User: $DB_ADMIN_USER"
echo "Database Admin Password: $DB_ADMIN_PASSWORD"
echo "Django Secret Key: –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ Key Vault"
echo "Storage Account Key: –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ Key Vault"
echo ""
echo "=========================================="
echo "üìù –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò"
echo "=========================================="
echo "1. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≤–∞—à Django –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Azure"
echo "2. –î–æ–¥–∞–π—Ç–µ —Å—Ç–≤–æ—Ä–µ–Ω—ñ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–æ –≤–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É"
echo "3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ CI/CD pipeline –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—é"
echo "4. –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö"
echo "5. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤ Application Insights"
echo ""
echo "üöÄ –í–∞—à Django –¥–æ–¥–∞—Ç–æ–∫ –≥–æ—Ç–æ–≤–∏–π –¥–æ –¥–µ–ø–ª–æ—é!"
echo "=========================================="

# –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —É —Ñ–∞–π–ª
cat > infrastructure-summary.txt << EOF
Django Azure Infrastructure Summary
===================================
Created: $(date)
Project: $PROJECT_NAME
Environment: $ENVIRONMENT

Resources:
- Resource Group: $RESOURCE_GROUP_NAME
- Web App: $WEB_APP_NAME
- URL: https://$APP_URL
- Database Server: $DATABASE_SERVER_NAME
- Database: $DATABASE_NAME
- Storage Account: $STORAGE_ACCOUNT_NAME
- Key Vault: $KEY_VAULT_NAME
- Application Insights: $APP_INSIGHTS_NAME

Database Credentials:
- Admin User: $DB_ADMIN_USER
- Admin Password: $DB_ADMIN_PASSWORD

Connection String:
$DATABASE_URL
EOF

log "üìÑ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞ —É —Ñ–∞–π–ª: infrastructure-summary.txt"

```
